"use strict";exports.id=8501,exports.ids=[8501],exports.modules={58501:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{i:()=>m});var e=c(24991),f=c(303),g=c(84749),h=c(7462),i=c(35144),j=c(55229),k=a([e,f,g,h,j]);[e,f,g,h,j]=k.then?(await k)():k;class l{async startCoordinatedScanning(){try{let a=await this.getCoordinationConfig();if(!a.enableCoordination)return void await (0,h.rP)(i.$b.INFO,"SOCIAL_MEDIA_COORDINATION_DISABLED","Social media coordination is disabled");this.coordinationTimer&&clearInterval(this.coordinationTimer);let b=60*a.scanInterval*1e3;this.coordinationTimer=setInterval(async()=>{this.isCoordinatedScanRunning||await this.performCoordinatedScan()},b),await this.performCoordinatedScan(),await (0,h.rP)(i.$b.INFO,"SOCIAL_MEDIA_COORDINATION_STARTED",`Coordinated scanning started with ${a.scanInterval} minute intervals`,{config:a})}catch(a){throw await (0,h.rP)(i.$b.ERROR,"SOCIAL_MEDIA_COORDINATION_START_ERROR",`Failed to start coordinated scanning: ${a.message}`,{error:a.message}),a}}async stopCoordinatedScanning(){this.coordinationTimer&&(clearInterval(this.coordinationTimer),this.coordinationTimer=void 0),await (0,h.rP)(i.$b.INFO,"SOCIAL_MEDIA_COORDINATION_STOPPED","Coordinated scanning stopped")}async performCoordinatedScan(){if(this.isCoordinatedScanRunning)throw Error("Coordinated scan already in progress");this.isCoordinatedScanRunning=!0;let a=`unified_scan_${Date.now()}`,b=new Date,c={scanId:a,startTime:b,endTime:new Date,platforms:[],totalPostsFound:0,totalPostsApproved:0,totalErrors:0,successfulPlatforms:0,failedPlatforms:0};try{let b=await this.getCoordinationConfig(),d=await this.getPlatformStatuses(),e=await this.determineScanOrder(b,d);for(let f of(await (0,h.rP)(i.$b.INFO,"COORDINATED_SCAN_STARTED",`Starting coordinated scan across ${e.length} platforms`,{scanId:a,platforms:e}),e)){let g=d.find(a=>a.platform===f);if(!g?.isEnabled||!g?.isAuthenticated){await (0,h.rP)(i.$b.WARNING,"PLATFORM_SCAN_SKIPPED",`Skipping ${f} scan: not enabled or not authenticated`,{scanId:a,platform:f});continue}if(b.rateLimitCoordination&&"critical"===g.rateLimitStatus){await (0,h.rP)(i.$b.WARNING,"PLATFORM_SCAN_SKIPPED_RATE_LIMIT",`Skipping ${f} scan: rate limit critical`,{scanId:a,platform:f});continue}let j=await this.scanPlatform(f,a);c.platforms.push(j),j.success?c.successfulPlatforms++:c.failedPlatforms++,c.totalPostsFound+=j.postsFound,c.totalPostsApproved+=j.postsApproved,c.totalErrors+=j.errors.length,b.rateLimitCoordination&&e.indexOf(f)<e.length-1&&await this.delay(5e3)}return c.endTime=new Date,b.contentBalancing.enabled&&await this.applyContentBalancing(c,b),await this.recordUnifiedScanResult(c),await (0,h.rP)(i.$b.INFO,"COORDINATED_SCAN_COMPLETED",`Coordinated scan completed: ${c.totalPostsApproved} posts approved across ${c.successfulPlatforms} platforms`,c),c}catch(b){throw c.endTime=new Date,c.totalErrors++,await (0,h.rP)(i.$b.ERROR,"COORDINATED_SCAN_ERROR",`Coordinated scan failed: ${b.message}`,{scanId:a,error:b.message}),b}finally{this.isCoordinatedScanRunning=!1}}async getPlatformStatuses(){let a=[];try{let b=await e.L.getScanConfig(),c=await e.L.testConnection();a.push({platform:"reddit",isEnabled:b.isEnabled,isAuthenticated:c.success,lastScanTime:b.lastScanTime,rateLimitStatus:"healthy",errorCount:0,contentType:"posts"});let d=await f.t.getScanConfig(),h=await f.t.testConnection();a.push({platform:"instagram",isEnabled:d.isEnabled,isAuthenticated:h.success,lastScanTime:d.lastScanTime,rateLimitStatus:"healthy",errorCount:0,contentType:"images"});let i=await g.f.getScanConfig(),j=await g.f.testConnection();a.push({platform:"tiktok",isEnabled:i.isEnabled,isAuthenticated:j.success,lastScanTime:i.lastScanTime,rateLimitStatus:"healthy",errorCount:0,contentType:"videos",quotaStatus:{hourlyUsed:0,hourlyLimit:100,dailyUsed:0,dailyLimit:1e3}})}catch(a){await (0,h.rP)(i.$b.ERROR,"PLATFORM_STATUS_ERROR",`Failed to get platform statuses: ${a.message}`,{error:a.message})}return a}async getUnifiedStats(){try{let a=await e.L.getScanStats(),b=await f.t.getScanStats(),c=await g.f.getScanStats(),d=[{platform:"reddit",scans:a.totalScans,postsFound:a.totalPostsFound,postsApproved:a.totalPostsApproved,successRate:a.successRate,contentType:"posts"},{platform:"instagram",scans:b.totalScans,postsFound:b.totalPostsFound,postsApproved:b.totalPostsApproved,successRate:b.successRate,contentType:"images"},{platform:"tiktok",scans:c.totalScans,postsFound:c.totalVideosFound,postsApproved:c.totalVideosApproved,successRate:c.successRate,contentType:"videos"}],h=a.totalScans+b.totalScans+c.totalScans,i=a.totalPostsFound+b.totalPostsFound+c.totalVideosFound,j=a.totalPostsApproved+b.totalPostsApproved+c.totalVideosApproved,k=d.length>0?d.reduce((a,b)=>a+b.successRate,0)/d.length:0,l=this.calculateContentDistribution(d),m=[a.lastScanTime,b.lastScanTime,c.lastScanTime].filter(Boolean),n=m.length>0?new Date(Math.max(...m.map(a=>a.getTime()))):void 0;return{totalScans:h,totalPostsFound:i,totalPostsApproved:j,platformBreakdown:d,contentDistribution:l,averageSuccessRate:k,lastScanTime:n}}catch(a){return await (0,h.rP)(i.$b.ERROR,"UNIFIED_STATS_ERROR",`Failed to get unified statistics: ${a.message}`,{error:a.message}),{totalScans:0,totalPostsFound:0,totalPostsApproved:0,platformBreakdown:[],contentDistribution:{posts:0,images:0,videos:0},averageSuccessRate:0}}}async scanPlatform(a,b){let c=Date.now();try{let b,d;return"reddit"===a?(b=await e.L.performScan(),d="posts"):"instagram"===a?(b=await f.t.performScan(),d="images"):(b=await g.f.performScan(),d="videos"),{platform:a,scanId:b.scanId,success:!0,postsFound:"videosFound"in b?b.videosFound:b.postsFound,postsApproved:"videosApproved"in b?b.videosApproved:b.postsApproved,errors:b.errors,duration:Date.now()-c,contentType:d}}catch(b){return{platform:a,scanId:`${a}_scan_error_${Date.now()}`,success:!1,postsFound:0,postsApproved:0,errors:[b.message],duration:Date.now()-c,contentType:"reddit"===a?"posts":"instagram"===a?"images":"videos"}}}async determineScanOrder(a,b){let c=b.filter(a=>a.isEnabled&&a.isAuthenticated).map(a=>a.platform),d=a.platformPriority.filter(a=>c.includes(a)),e=c.filter(a=>!d.includes(a));return d=[...d,...e],a.intelligentScheduling.enabled&&(d=await this.applyIntelligentScheduling(d,a,b)),a.rateLimitCoordination&&d.sort((a,c)=>{let d=b.find(b=>b.platform===a),e=b.find(a=>a.platform===c),f=2*(d?.rateLimitStatus!=="healthy"),g=2*(e?.rateLimitStatus!=="healthy");return d?.platform==="tiktok"&&d.quotaStatus&&d.quotaStatus.hourlyUsed/d.quotaStatus.hourlyLimit*100>80&&(f+=1),e?.platform==="tiktok"&&e.quotaStatus&&e.quotaStatus.hourlyUsed/e.quotaStatus.hourlyLimit*100>80&&(g+=1),f-g}),d}async applyIntelligentScheduling(a,b,c){let d=new Date().getHours().toString().padStart(2,"0");return a.sort((a,c)=>{let e=+!b.intelligentScheduling.peakContentTimes[a]?.includes(d),f=+!b.intelligentScheduling.peakContentTimes[c]?.includes(d);return e-f})}calculateContentDistribution(a){let b=a.reduce((a,b)=>a+b.postsApproved,0);if(0===b)return{posts:0,images:0,videos:0};let c=a.filter(a=>"posts"===a.contentType).reduce((a,b)=>a+b.postsApproved,0),d=a.filter(a=>"images"===a.contentType).reduce((a,b)=>a+b.postsApproved,0),e=a.filter(a=>"videos"===a.contentType).reduce((a,b)=>a+b.postsApproved,0);return{posts:Math.round(c/b*100),images:Math.round(d/b*100),videos:Math.round(e/b*100)}}async applyContentBalancing(a,b){await (0,h.rP)(i.$b.INFO,"CONTENT_BALANCING_APPLIED","Content balancing applied to unified scan result",{scanId:a.scanId,balancing:b.contentBalancing,platforms:a.platforms.map(a=>({platform:a.platform,approved:a.postsApproved}))})}async recordUnifiedScanResult(a){await (0,h.rP)(i.$b.INFO,"UNIFIED_SCAN_RECORDED","Unified scan result recorded",{scanId:a.scanId,summary:{platforms:a.platforms.length,totalFound:a.totalPostsFound,totalApproved:a.totalPostsApproved,successful:a.successfulPlatforms,failed:a.failedPlatforms}})}async getCoordinationConfig(){try{let a=await (0,j.P)("social_media_coordination_config").select("*").first();if(!a)return{enableCoordination:!0,scanInterval:60,platformPriority:["reddit","instagram","tiktok"],contentBalancing:{enabled:!0,redditWeight:40,instagramWeight:35,tiktokWeight:25,targetDistribution:{posts:40,images:35,videos:25}},rateLimitCoordination:!0,errorThreshold:5,intelligentScheduling:{enabled:!0,peakContentTimes:{reddit:["09","12","15","18","21"],instagram:["08","11","14","17","19"],tiktok:["16","18","20","21","22"]},adaptiveIntervals:!0}};return{enableCoordination:a.enable_coordination,scanInterval:a.scan_interval,platformPriority:a.platform_priority||["reddit","instagram","tiktok"],contentBalancing:{enabled:a.content_balancing_enabled,redditWeight:a.reddit_weight||40,instagramWeight:a.instagram_weight||35,tiktokWeight:a.tiktok_weight||25,targetDistribution:a.target_distribution||{posts:40,images:35,videos:25}},rateLimitCoordination:a.rate_limit_coordination,errorThreshold:a.error_threshold,intelligentScheduling:a.intelligent_scheduling||{enabled:!0,peakContentTimes:{reddit:["09","12","15","18","21"],instagram:["08","11","14","17","19"],tiktok:["16","18","20","21","22"]},adaptiveIntervals:!0}}}catch(a){return{enableCoordination:!0,scanInterval:60,platformPriority:["reddit","instagram","tiktok"],contentBalancing:{enabled:!0,redditWeight:40,instagramWeight:35,tiktokWeight:25,targetDistribution:{posts:40,images:35,videos:25}},rateLimitCoordination:!0,errorThreshold:5,intelligentScheduling:{enabled:!0,peakContentTimes:{reddit:["09","12","15","18","21"],instagram:["08","11","14","17","19"],tiktok:["16","18","20","21","22"]},adaptiveIntervals:!0}}}}delay(a){return new Promise(b=>setTimeout(b,a))}constructor(){this.isCoordinatedScanRunning=!1}}let m=new l;d()}catch(a){d(a)}})}};