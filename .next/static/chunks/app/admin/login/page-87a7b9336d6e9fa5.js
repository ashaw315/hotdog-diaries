(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2116],{471:(e,t,s)=>{Promise.resolve().then(s.bind(s,9719))},3274:(e,t,s)=>{"use strict";s.d(t,{As:()=>l,Nu:()=>d,OH:()=>c,OJ:()=>o});var r=s(5155),a=s(2115),n=s(5695);let i=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[s,o]=(0,a.useState)({user:null,isLoading:!0,isAuthenticated:!1}),l=(0,n.useRouter)(),d=(0,n.useSearchParams)(),c=async()=>{try{let e=await fetch("/api/admin/me",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(e.ok)return(await e.json()).data;return null}catch(e){return console.error("Failed to fetch current user:",e),null}},u=async()=>{o(e=>({...e,isLoading:!0}));try{let e=await c();o({user:e,isLoading:!1,isAuthenticated:!!e})}catch(e){console.error("Auth initialization failed:",e),o({user:null,isLoading:!1,isAuthenticated:!1})}},m=async(e,t)=>{try{let s=await fetch("/api/admin/login",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}),r=await s.json();if(!s.ok)throw Error(r.error||"Login failed");o({user:r.data.user,isLoading:!1,isAuthenticated:!0});let a=d.get("from")||"/admin";l.push(a)}catch(e){throw console.error("Login failed:",e),e}},h=async()=>{try{await fetch("/api/admin/logout",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}catch(e){console.error("Logout request failed:",e)}finally{o({user:null,isLoading:!1,isAuthenticated:!1}),l.push("/admin/login")}},f=async()=>{let e=await c();o(t=>({...t,user:e,isAuthenticated:!!e}))},x=async()=>{try{if((await fetch("/api/admin/refresh",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)return await f(),!0;return!1}catch(e){return console.error("Token refresh failed:",e),!1}};(0,a.useEffect)(()=>{let e;return s.isAuthenticated&&(e=setInterval(()=>{x()},828e5)),()=>{e&&clearInterval(e)}},[s.isAuthenticated]),(0,a.useEffect)(()=>{let e=async()=>{await x()||(o({user:null,isLoading:!1,isAuthenticated:!1}),"/admin/login"!==window.location.pathname&&l.push("/admin/login"))},t=window.fetch;return window.fetch=async function(){for(var r=arguments.length,a=Array(r),n=0;n<r;n++)a[n]=arguments[n];let i=await t(...a);return 401===i.status&&s.isAuthenticated&&await e(),i},()=>{window.fetch=t}},[s.isAuthenticated,l]),(0,a.useEffect)(()=>{u()},[]);let g={...s,login:m,logout:h,refreshUser:f};return(0,r.jsx)(i.Provider,{value:g,children:t})}function l(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function d(){let e=l(),t=(0,n.useRouter)();return(0,a.useEffect)(()=>{e.isLoading||e.isAuthenticated||t.push("/admin/login")},[e.isLoading,e.isAuthenticated,t]),e}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/admin",t=l(),s=(0,n.useRouter)();return(0,a.useEffect)(()=>{!t.isLoading&&t.isAuthenticated&&s.push(e)},[t.isLoading,t.isAuthenticated,s,e]),t}},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},9719:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var r=s(5155),a=s(2115),n=s(5695),i=s(3274);function o(){let[e,t]=(0,a.useState)({username:"",password:"",rememberMe:!1}),[s,o]=(0,a.useState)(null),[l,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),{login:m}=(0,i.As)(),h=(0,n.useSearchParams)();(0,i.OH)();let f=h.get("error"),x=async t=>{t.preventDefault(),o(null),d(!0);try{if(!e.username.trim())throw Error("Username is required");if(!e.password)throw Error("Password is required");await m(e.username.trim(),e.password)}catch(e){o({message:e instanceof Error?e.message:"Login failed"})}finally{d(!1)}},g=(e,r)=>{t(t=>({...t,[e]:r})),s&&o(null)},p=()=>{if(s)return s.message;if(f)switch(f){case"auth_service_error":return"Authentication service is temporarily unavailable. Please try again.";case"session_expired":return"Your session has expired. Please log in again.";default:return"An error occurred. Please try logging in again."}return null};return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"mx-auto h-12 w-12 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-4xl",children:"\uD83C\uDF2D"})}),(0,r.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Admin Login"}),(0,r.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to access the Hotdog Diaries admin panel"})]}),(0,r.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:x,children:[(0,r.jsxs)("div",{className:"rounded-md shadow-sm space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,r.jsx)("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Enter your username",value:e.username,onChange:e=>g("username",e.target.value),disabled:l})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{id:"password",name:"password",type:c?"text":"password",autoComplete:"current-password",required:!0,className:"appearance-none relative block w-full px-3 py-2 pr-10 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Enter your password",value:e.password,onChange:e=>g("password",e.target.value),disabled:l}),(0,r.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>u(!c),disabled:l,children:(0,r.jsx)("span",{className:"text-gray-400 hover:text-gray-600",children:c?"\uD83D\uDE48":"\uD83D\uDC41️"})})]})]})]}),(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:e.rememberMe,onChange:e=>g("rememberMe",e.target.checked),disabled:l}),(0,r.jsx)("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900",children:"Remember me"})]})}),p()&&(0,r.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("span",{className:"text-red-400",children:"❌"})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Login Failed"}),(0,r.jsx)("div",{className:"mt-2 text-sm text-red-700",children:p()})]})]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("button",{type:"submit",disabled:l,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:[l&&(0,r.jsx)("span",{className:"absolute left-0 inset-y-0 flex items-center pl-3",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"})}),l?"Signing in...":"Sign in"]})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"By signing in, you agree to the terms of service and privacy policy."})})]}),!1]})})}}},e=>{e.O(0,[8441,5964,7358],()=>e(e.s=471)),_N_E=e.O()}]);