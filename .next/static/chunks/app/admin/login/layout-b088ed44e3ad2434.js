(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9591],{3274:(e,t,n)=>{"use strict";n.d(t,{As:()=>o,Nu:()=>c,OH:()=>d,OJ:()=>u});var i=n(5155),a=n(2115),r=n(5695);let s=(0,a.createContext)(void 0);function u(e){let{children:t}=e,[n,u]=(0,a.useState)({user:null,isLoading:!0,isAuthenticated:!1}),o=(0,r.useRouter)(),c=(0,r.useSearchParams)(),d=async()=>{try{let e=await fetch("/api/admin/me",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(e.ok)return(await e.json()).data;return null}catch(e){return console.error("Failed to fetch current user:",e),null}},l=async()=>{u(e=>({...e,isLoading:!0}));try{let e=await d();u({user:e,isLoading:!1,isAuthenticated:!!e})}catch(e){console.error("Auth initialization failed:",e),u({user:null,isLoading:!1,isAuthenticated:!1})}},h=async(e,t)=>{try{let n=await fetch("/api/admin/login",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}),i=await n.json();if(!n.ok)throw Error(i.error||"Login failed");u({user:i.data.user,isLoading:!1,isAuthenticated:!0});let a=c.get("from")||"/admin";o.push(a)}catch(e){throw console.error("Login failed:",e),e}},f=async()=>{try{await fetch("/api/admin/logout",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}catch(e){console.error("Logout request failed:",e)}finally{u({user:null,isLoading:!1,isAuthenticated:!1}),o.push("/admin/login")}},m=async()=>{let e=await d();u(t=>({...t,user:e,isAuthenticated:!!e}))},w=async()=>{try{if((await fetch("/api/admin/refresh",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)return await m(),!0;return!1}catch(e){return console.error("Token refresh failed:",e),!1}};(0,a.useEffect)(()=>{let e;return n.isAuthenticated&&(e=setInterval(()=>{w()},828e5)),()=>{e&&clearInterval(e)}},[n.isAuthenticated]),(0,a.useEffect)(()=>{let e=async()=>{await w()||(u({user:null,isLoading:!1,isAuthenticated:!1}),"/admin/login"!==window.location.pathname&&o.push("/admin/login"))},t=window.fetch;return window.fetch=async function(){for(var i=arguments.length,a=Array(i),r=0;r<i;r++)a[r]=arguments[r];let s=await t(...a);return 401===s.status&&n.isAuthenticated&&await e(),s},()=>{window.fetch=t}},[n.isAuthenticated,o]),(0,a.useEffect)(()=>{l()},[]);let p={...n,login:h,logout:f,refreshUser:m};return(0,i.jsx)(s.Provider,{value:p,children:t})}function o(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let e=o(),t=(0,r.useRouter)();return(0,a.useEffect)(()=>{e.isLoading||e.isAuthenticated||t.push("/admin/login")},[e.isLoading,e.isAuthenticated,t]),e}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/admin",t=o(),n=(0,r.useRouter)();return(0,a.useEffect)(()=>{!t.isLoading&&t.isAuthenticated&&n.push(e)},[t.isLoading,t.isAuthenticated,n,e]),t}},4660:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var i=n(5155),a=n(3274);function r(e){let{children:t}=e;return(0,i.jsx)(a.OJ,{children:t})}},5695:(e,t,n)=>{"use strict";var i=n(8999);n.o(i,"usePathname")&&n.d(t,{usePathname:function(){return i.usePathname}}),n.o(i,"useRouter")&&n.d(t,{useRouter:function(){return i.useRouter}}),n.o(i,"useSearchParams")&&n.d(t,{useSearchParams:function(){return i.useSearchParams}})},6805:(e,t,n)=>{Promise.resolve().then(n.bind(n,4660))}},e=>{e.O(0,[8441,5964,7358],()=>e(e.s=6805)),_N_E=e.O()}]);